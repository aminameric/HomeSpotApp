<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Property Single - EstateAgency Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  

  <!-- Prefetch Important Resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="assets/css/main.css" as="style">

  <!-- Add Web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.4.0/dist/ethers.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>


  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&family=Poppins:wght@100;300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 1000; /* Ensure it's above everything else */
      background-color: rgba(0,0,0,0.5); /* Black background with transparency */
      justify-content: center;
      align-items: center;
      transition: opacity 0.3s ease-in-out; /* Smooth transition */
    }

    .modal.show {
      display: flex; /* Show the modal and use flexbox for centering */
      opacity: 1; /* Full opacity */
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      z-index: 1001; /* Ensure it's above the background */
      position: relative;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }


    .button-container {
    display: flex;
    justify-content: center;  /* Center buttons horizontally */
    align-items: center;      /* Align buttons vertically in case of different heights */
    flex-wrap: wrap;          /* Allow wrapping if there are too many buttons for small screens */
    gap: 10px;                /* Adds spacing between buttons */
}

button {
    padding: 10px 20px;       /* Adjust padding for button size */
    font-size: 16px;          /* Adjust font size to make buttons look consistent */
}

.btn-custom {
    margin: 5px;              /* Add a small margin for extra space between buttons */
}


  .btn-custom:hover {
      background-color: #28a745; /* Green hover effect */
      color: white;
  }

  #deletePropertyBtn {
      background-color: #c82333; /* Slightly darker red on hover */
      color: white;
  }

  .modal-footer {
    display: flex;
    justify-content: space-between; /* Ensures the buttons are next to each other */
    gap: 10px; /* Adds a small gap between the buttons */
    margin-top: 20px;
    padding: 10px 0; /* Adjust padding for a more compact look */
}

.modal-footer button {
    flex-grow: 1; /* Allows buttons to grow equally */
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    width: auto; /* Ensure buttons are auto-sized */
}




/* Additional styling for text alignment, spacing, and form fields */

.modal-content h3 {
    margin-bottom: 20px; /* Add space below the title */
    font-size: 24px; /* Larger font size for the modal title */
    text-align: center;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    color: #333;
}

.form-control {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 16px;
}

.textarea {
    min-height: 100px;
}

/* Modal Footer */

.btn-secondary {
    background-color: #6c757d;
    color: white;
    transition: background-color 0.3s;
}

.btn-secondary:hover {
    background-color: #5a6268;
}

.btn-primary {
    background-color: #28a745;
    color: white;
    transition: background-color 0.3s;
}

.btn-primary:hover {
    background-color: #218838;
}

.modal-content.card-form {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 100%;
    text-align: left;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-family: 'Poppins', sans-serif;
  }


  .card-info-section {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }

  /* Style for card number input */
  /* Style for card number input */
#card-number {
    letter-spacing: 2px;
    font-size: 18px;
}

/* Styling for Expiry Date and CVC fields */
#expiry-date, #cvc {
    width: 48%;
}
/* Align Expiry Date and CVC inputs side by side */
.card-info-section.inline {
    display: flex;
    justify-content: space-between;
}



</style>
</head>

<body class="property-single-page">

  <main class="main">
    <!-- Page Title -->
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Property Single</h1>
              <p class="mb-0">Specific information about the property: </p>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="#index">Home</a></li>
            <li class="current">Property Single</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->

    <!-- Real Estate 2 Section -->
    <section id="real-estate-2" class="real-estate-2 section">
      <div class="container" data-aos="fade-up">
        <div class="portfolio-details-slider swiper init-swiper">
          <div class="row justify-content-between gy-4 mt-4">
            <div class="col-lg-8" data-aos="fade-up">
              <div class="portfolio-description">
                <h2>Name: <span id="property-name"></span></h2>
                <div class="testimonial-item">
                  <p>
                    <span id="property-info">We are here to</span>
                  </p>
                  <div>
                    <img id="agent-image" src="assets/img/testimonials/testimonials-2.jpg" class="testimonial-img" alt="">
                    <h3><span id="agent-name"></span></h3>
                    <h4>Agent</h4>
                  </div>
                </div>
              </div><!-- End Portfolio Description -->

              <!-- Tabs -->
              <ul class="nav nav-pills mb-3">
                <li><a class="nav-link active" data-bs-toggle="pill" href="#real-estate-2-tab1">Photo</a></li>
                <li><a class="nav-link" data-bs-toggle="pill" href="#real-estate-2-tab2">Floor Plan</a></li>
              </ul><!-- End Tabs -->

              <!-- Tab Content -->
              <div class="tab-content">
                <div class="tab-pane fade show active" id="real-estate-2-tab1">
                  <img id="real-estate-image" src="default.jpg" alt="Property Image">
                </div><!-- End Tab 1 Content -->

                <div class="tab-pane fade" id="real-estate-2-tab2">
                  <img src="assets/img/floor-plan.jpg" alt="" class="img-fluid" id="floor-image">
                </div><!-- End Tab 2 Content -->
              </div><!-- End Tab Content -->

              <!-- Button to open modal -->
              <div class="button-container">
                <!-- Button to open edit modal -->
                <button type="button" class="btn btn-primary btn-custom d-none" id="openModal">Edit Property</button>
                <!-- Button to open delete confirmation modal -->
                <button type="button" class="btn btn-danger btn-custom d-none" id="deletePropertyBtn">Delete Property</button>

                <!-- Reserve button -->
                <button type="button" class="btn btn-secondary btn-custom d-none" id="reserveBtn">Book a Visit</button>

                <!-- Buy button -->
                <button type="button" class="btn btn-secondary btn-custom d-none" id="buyBtn">Buy</button>

                <button type="button" class="btn btn-secondary btn-custom d-none" id="connect-wallet-btn">Connect MetaMask Wallet</button>
                <button type="button" class="btn btn-secondary btn-custom" id="disconnect-wallet-btn" style="display:none;">Disconnect MetaMask Wallet</button>
              <!-- Transaction Button -->
              <button type="button" class="btn btn-secondary btn-custom" id="buy-property-btn" style="display:none;">Buy Property with MetaMask</button>
              </div>

<!--edit modal-->
<div id="myModal" class="modal">
  <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Edit Property Details</h3>
      <form id="edit-property-form">
          <div class="form-group">
            <label for="property-name">Property Name</label>
            <input type="text" class="form-control" id="property-name-input" placeholder="Enter property name">
          </div>
          <div class="form-group">
              <label for="property-description">Property Description</label>
              <textarea class="form-control" id="property-description" rows="3" placeholder="Enter property description"></textarea>
          </div>
          <div class="form-group">
              <label for="property-price">Property Price</label>
              <input type="number" class="form-control" id="property-price" placeholder="Enter property price">
          </div>
      </form>
      <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
          <button type="button" class="btn btn-primary" id="save-property-btn1">Save changes</button>
      </div>
  </div>
</div>


<!-- Delete Confirmation Modal Structure -->
                <div id="deleteModal" class="modal">
                  <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>Confirm Delete</h3>
                    <p>Are you sure you want to delete this property?</p>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" id="cancel-delete-btn">No</button>
                      <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Yes</button>
                    </div>
                  </div>
                </div>

<!--reserve modal-->
<div id="myReservartionModal" class="modal">
  <div class="modal-content">
    <!-- Close button in the top-right corner -->
    <span class="close">&times;</span>
    <h3>Book a Property Visit</h3>
    
    <form id="reserve-property-form">
      <div class="form-group">
        <label class="label">Reservation Date</label>
        <input class="input" type="date" id="reservation-date" required>
      </div>
      <div class="form-group">
        <label class="label">Additional Comments</label>
        <textarea class="textarea" id="reservation-comments" placeholder="Enter any additional comments"></textarea>
      </div>
    </form>
    
    <div class="modal-footer">
      <!-- Cancel/Close button -->
      <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
      <!-- Save changes button -->
      <button type="button" class="btn btn-primary" id="save-property-btn">Save changes</button>
    </div>
  </div>
</div>

<!-- Buy Property Modal Structure -->
<!-- Modal for Credit Card Form -->
<div id="buyModal" class="modal">
  <div class="modal-content card-form">
      <span class="close">&times;</span>
      <h3 class="mb-4">Enter Payment Details</h3>
      <form id="buy-property-form">
          <div class="mb-3">
              <label for="card-number" class="form-label">Card Number</label>
              <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-credit-card"></i></span>
                  <input type="text" class="form-control" id="card-number" placeholder="0123 4521 7417 0001" maxlength="19" required>
              </div>
          </div>
          <div class="mb-3">
              <label for="card-holder-name" class="form-label">Card Holder Name</label>
              <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                  <input type="text" class="form-control" id="card-holder-name" placeholder="Amina Meric" required>
              </div>
          </div>
          <div class="row">
              <div class="col-md-6 mb-3">
                  <label for="expiry-date" class="form-label">Expiry Date</label>
                  <input type="text" class="form-control" id="expiry-date" placeholder="MM/YY" maxlength="5" required>
              </div>
              <div class="col-md-6 mb-3">
                  <label for="cvc" class="form-label">CVC</label>
                  <input type="text" class="form-control" id="cvc" placeholder="123" maxlength="3" required>
              </div>
          </div>
          <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" id="cancel-buy-btn">Cancel</button>
              <button type="button" class="btn btn-primary" id="submit-buy-btn">Submit Payment</button>
          </div>
      </form>
  </div>
  
</div>


            </div>
            <div class="col-lg-3" data-aos="fade-up" data-aos-delay="100">
              <div class="portfolio-info">
                <h3>Quick Summary</h3>
                <ul>
                  <li><strong>Price:</strong> <span id="property-price-display"></span></li>
                  <li><strong>Bedrooms:</strong> 4</li>
                  <li><strong>Bathrooms:</strong> 1</li>
                  <li><strong>Area:</strong> <span>340m2</span></li>
                  <li><strong>Street Address:</strong> Stupska 19</li>
                  <li><strong>City:</strong> Sarajevo </li>
                  <li><strong>Country:</strong> Bosnia and Herzegovina </li>
                  <li><strong>Property Type:</strong> House</li>
                  <li><strong>Postal Code:</strong> 71000</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section><!-- /Real Estate 2 Section -->

  </main>

  <!-- Bootstrap and jQuery (ensure these are loaded properly) -->
  
  <script src="assets/js/jquery.creditCardValidator.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="assets/js/singleproperty.js"></script>
  <script src="assets/js/buyproperty.js"></script>
  <script src="assets/js/metamask.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  



  <!-- Custom Script to control modal -->
  <script>
    $(document).ready (function(){

    
    console.log('Script for button control is running');

    // Check if user exists in localStorage
    const rawUser = localStorage.getItem('user');
    if (!rawUser) {
        console.error('No user data found in localStorage');
        return;
    }

    let user = null;

    try {
        // Parse the user data
        user = JSON.parse(rawUser);

        // Check if user object contains 'type_of_user'
        if (!user.type_of_user) {
            console.error('User does not have type_of_user property');
            return;
        }

        const type_of_user = user.type_of_user;
        console.log('type_of_user:', type_of_user);

        // Buttons for Agent role
        if (type_of_user === 'Agent') {
            document.getElementById('deletePropertyBtn').classList.remove('d-none');
            document.getElementById('openModal').classList.remove('d-none');

            // Also hide the Reserve and Buy buttons for the Agent
            document.getElementById('reserveBtn').classList.add('d-none');
            document.getElementById('buyBtn').classList.add('d-none');
            document.getElementById('connect-wallet-btn').classList.add('d-none');

            // Attach event listeners to the Edit and Delete buttons after making them visible
            attachEventListeners();

        } else {
            // Hide the buttons if not Agent
            document.getElementById('deletePropertyBtn').classList.add('d-none');
            document.getElementById('openModal').classList.add('d-none');

            // Show Reserve and Buy buttons for non-Agent users
            document.getElementById('reserveBtn').classList.remove('d-none');
            document.getElementById('buyBtn').classList.remove('d-none');
            document.getElementById('connect-wallet-btn').classList.remove('d-none');

            // Attach event listeners to the Buy and Reserve buttons
            attachBuyAndReserveListeners();
        }
    } catch (error) {
        console.error('Error parsing user data from localStorage:', error);
    }
    });

// Function to attach event listeners for edit and delete buttons
function attachEventListeners() {
    const editModal = document.getElementById('myModal');
    const editPropertyBtn = document.getElementById('openModal');
    const cancelEditBtn = document.getElementById('cancel-btn');

    const deleteModal = document.getElementById('deleteModal');
    const deletePropertyBtn = document.getElementById('deletePropertyBtn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

    // Close buttons for both modals (Edit and Delete)
    const closeBtns = document.querySelectorAll('.close');

    // Open the Edit Property modal
    if (editPropertyBtn) {
        editPropertyBtn.addEventListener('click', function () {
            console.log('Edit modal opened'); // Debugging log
            editModal.classList.add('show'); // Show the Edit modal
        });
    }

    // Open the Delete Confirmation modal
    if (deletePropertyBtn) {
        deletePropertyBtn.addEventListener('click', function () {
            console.log('Delete modal opened'); // Debugging log
            deleteModal.classList.add('show'); // Show the Delete modal
        });
    }

    // Close the modals when clicking the X button (for both modals)
    closeBtns.forEach(function (btn) {
        btn.addEventListener('click', function () {
            console.log('Modal closed by clicking X'); // Debugging log
            editModal.classList.remove('show'); // Hide the Edit modal
            deleteModal.classList.remove('show'); // Hide the Delete modal
        });
    });

    // Close the Edit modal if the user clicks 'Cancel'
    if (cancelEditBtn) {
        cancelEditBtn.addEventListener('click', function () {
            console.log('Edit modal canceled'); // Debugging log
            editModal.classList.remove('show');
        });
    }

    // Close the Delete modal if the user clicks 'No' (Cancel Delete)
    if (cancelDeleteBtn) {
        cancelDeleteBtn.addEventListener('click', function () {
            console.log('Delete modal canceled'); // Debugging log
            deleteModal.classList.remove('show');
        });
    }

    // Handle the Delete confirmation ('Yes' button clicked)
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function () {
            console.log('Delete confirmed'); // Debugging log
            deleteProperty(); // Call your delete function (you need to define this)
            deleteModal.classList.remove('show'); // Hide the modal
        });
    }

    // Close any modal if the user clicks outside of the modal content
    window.addEventListener('click', function (event) {
        if (event.target == editModal) {
            console.log('Clicked outside Edit modal'); // Debugging log
            editModal.classList.remove('show');
        } else if (event.target == deleteModal) {
            console.log('Clicked outside Delete modal'); // Debugging log
            deleteModal.classList.remove('show');
        }
    });
}

// Function to attach event listeners for Buy and Reserve buttons
function attachBuyAndReserveListeners() {
    const reserveModal = document.getElementById('myReservartionModal');
    const buyModal = document.getElementById('buyModal');
    const reserveBtn = document.getElementById('reserveBtn');
    const buyBtn = document.getElementById('buyBtn');
    const cancelBuyBtn = document.getElementById('cancel-buy-btn'); // Buy modal cancel button
    const buyCloseBtn = buyModal.querySelector('.close'); // X button inside Buy modal

    // Open the Reserve Modal
    if (reserveBtn) {
        reserveBtn.addEventListener('click', function () {
            console.log('Reserve modal opened'); // Debugging log
            reserveModal.classList.add('show');
        });
    }

    // Open the Buy Modal
    if (buyBtn) {
        buyBtn.addEventListener('click', function () {
            console.log('Buy modal opened'); // Debugging log
            buyModal.classList.add('show');
        });
    }

    // Close the Buy modal when the 'Cancel' button is clicked
    if (cancelBuyBtn) {
        cancelBuyBtn.addEventListener('click', function () {
            console.log('Buy modal canceled'); // Debugging log
            buyModal.classList.remove('show');
        });
    }

    // Close the Buy modal when the 'X' button is clicked
    if (buyCloseBtn) {
        buyCloseBtn.addEventListener('click', function () {
            console.log('Buy modal closed by X'); // Debugging log
            buyModal.classList.remove('show');
        });
    }

    // Close the Buy modal if the user clicks outside the modal content
    window.addEventListener('click', function (event) {
        if (event.target == buyModal) {
            console.log('Clicked outside Buy modal'); // Debugging log
            buyModal.classList.remove('show');
        }
    });
}


</script>




<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>




<!--metamask-->
<!--<script>
  let userAccount;

  // Connect to MetaMask
  document.getElementById('connect-wallet-btn').addEventListener('click', async () => {
    if (typeof window.ethereum !== 'undefined') {
      try {
        // Request account access if needed
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        userAccount = accounts[0];
        console.log('Connected account:', userAccount);

        // Show the buy button once connected
        document.getElementById('buy-property-btn').style.display = 'block';
      } catch (error) {
        console.error('User rejected account access');
      }
    } else {
      alert('MetaMask is not installed. Please install it to use this feature.');
    }
  });

  // Buy property with MetaMask
  document.getElementById('buy-property-btn').addEventListener('click', async () => {
    const propertyPriceInEth = "0.1"; // The price of the property in Ether (ETH)

    // Make a transaction
    const transactionParameters = {
      to: '0x3B2bBcBB111cE699b540e34D0F2Cf4Cd36838566', // The address where the payment will go
      from: userAccount, // The account currently connected
      value: web3.utils.toHex(web3.utils.toWei(propertyPriceInEth, 'ether')), // The value in ETH (converted to Wei)
      gas: '2000000' // Gas limit
    };

    try {
      const txHash = await ethereum.request({
        method: 'eth_sendTransaction',
        params: [transactionParameters],
      });

      console.log('Transaction successful:', txHash);
      alert('Transaction Successful. Transaction hash: ' + txHash);
    } catch (error) {
      console.error('Transaction failed:', error);
    }
  });

  // Disconnect MetaMask Wallet
document.getElementById('disconnect-wallet-btn').addEventListener('click', () => {
    // Clear the locally stored account
    userAccount = null;
    localStorage.removeItem('connectedAccount');

    // Hide the disconnect and buy buttons
    document.getElementById('buy-property-btn').style.display = 'none';
    document.getElementById('disconnect-wallet-btn').style.display = 'none';
    document.getElementById('connect-wallet-btn').style.display = 'block';

    console.log('Wallet disconnected');
});

// Automatically check if wallet is already connected (e.g., page refresh)
window.addEventListener('load', () => {
    const connectedAccount = localStorage.getItem('connectedAccount');
    if (connectedAccount) {
        userAccount = connectedAccount;
        document.getElementById('buy-property-btn').style.display = 'block';
        document.getElementById('disconnect-wallet-btn').style.display = 'block';
        document.getElementById('connect-wallet-btn').style.display = 'none';
    }
});
</script>-->

</body>

</html>